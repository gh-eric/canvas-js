var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,d=[];!(b=a.next()).done;)d.push(b.value);return d};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var d=$jscomp.propertyToPolyfillSymbol[b];if(null==d)return a[b];d=a[d];return void 0!==d?d:a[b]};
$jscomp.polyfill=function(a,b,d,k){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,d,k):$jscomp.polyfillUnisolated(a,b,d,k))};$jscomp.polyfillUnisolated=function(a,b,d,k){d=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var n=a[k];if(!(n in d))return;d=d[n]}a=a[a.length-1];k=d[a];b=b(k);b!=k&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,d,k){var n=a.split(".");a=1===n.length;k=n[0];k=!a&&k in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var t=0;t<n.length-1;t++){var z=n[t];if(!(z in k))return;k=k[z]}n=n[n.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?k[n]:null;b=b(d);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,n,{configurable:!0,writable:!0,value:b}):b!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[n]&&(d=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[n]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(n):$jscomp.POLYFILL_PREFIX+d+"$"+n),$jscomp.defineProperty(k,$jscomp.propertyToPolyfillSymbol[n],{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(d){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype["return"]=function(a){this.abruptCompletion_={"return":a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){var d=$jscomp.makeIterator(a),k=d.next();$jscomp.generator.ensureIteratorResultIsObject_(k);if(k.done)this.yieldResult=k.value,this.nextAddress=b;else return this.yieldAllIterator_=d,this.yield(k.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,d){d?this.finallyContexts_[d]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){var d=this.finallyContexts_.splice(b||0)[0];if(d=this.abruptCompletion_=this.abruptCompletion_||d){if(d.isException)return this.jumpToErrorHandler_();void 0!=d.jumpTo&&this.finallyAddress_<d.jumpTo?(this.nextAddress=d.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(d){return{value:d,done:!0}},a,this.context_["return"]);this.context_["return"](a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,d){try{var k=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(k);if(!k.done)return this.context_.stop_(),k;var n=k.value}catch(t){return this.context_.yieldAllIterator_=null,this.context_.throw_(t),this.nextStep_()}this.context_.yieldAllIterator_=null;d.call(this.context_,n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a["return"],done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this["throw"]=function(b){return a.throw_(b)};this["return"]=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){var d=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(d,a.prototype);return d};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(k){return a.next(k)}function d(k){return a["throw"](k)}return new Promise(function(k,n){function t(z){z.done?k(z.value):Promise.resolve(z.value).then(b,d).then(t,n)}t(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
var api=window.location.origin+"/api/v1/";$(ta_todo());$(add_people_functions());$(hide_sidebars());$(add_profile_grades());$(add_profile_file_quota_status());var sleep=function(a){return new Promise(function(b){return setTimeout(b,a)})};function is_todo_page(){return"/"==window.location.pathname||is_course_page()}function is_dashboard(){return"/"==window.location.pathname}function is_course_page(){var a;return null!=(a=RegExp("/courses/[0-9]*$").test(window.location.pathname))?a:!1}
function is_course_user_page(){var a;return null!=(a=RegExp("/courses/[0-9]+/users$").test(window.location.pathname))?a:!1}function is_calendar_page(){var a;return null!=(a=RegExp("/calendar.*$").test(window.location.pathname))?a:!1}function get_course_from_uri(a){return(a=a.match(".*/courses/([0-9]+).*"))?a[1]:null}function is_student_or_observer(){var a,b;return!(null==(a=window.ENV)?0:a.current_user_roles.includes("teacher"))&&!(null==(b=window.ENV)?0:b.current_user_roles.includes("admin"))}
function is_user_profile_page(){var a;return null!=(a=RegExp("/users/[0-9]+$").test(window.location.pathname))?a:!1}function is_user_profile_settings_page(){var a;return null!=(a=RegExp("/profile/settings$").test(window.location.pathname))?a:!1}function get_user_from_profile_uri(){return is_user_profile_page()?window.location.pathname.split("/").reverse()[0]:0}
function fetch_parse_canvas(a){var b,d,k,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){switch(t.nextAddress){case 1:return t.setCatchFinallyBlocks(2),t.yield(fetch(a),4);case 4:d=t.yieldResult;if(!d.ok){k=null;t.jumpTo(5);break}return t.yield(d.text(),6);case 6:k=t.yieldResult;case 5:(b=k)&&b.startsWith("while(1);")&&(b=b.substring(9,b.length));b&&(b=JSON.parse(b));t.leaveTryBlock(3);break;case 2:n=t.enterCatchBlock(),console.log(n),b=null;case 3:return t["return"](b)}})}
function get_cal_event(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(fetch_parse_canvas(api+"calendar_events/"+a),2);b=d.yieldResult;return d["return"](b)})}function downloadCSV(a,b){var d=new Blob([a],{type:"text/csv"});var k=document.createElement("a");k.download=b;k.href=window.URL.createObjectURL(d);k.style.display="none";document.body.appendChild(k);k.click()}
function exportTableToCSV(a,b,d,k){d=void 0===d?"canvas_table_export.csv":d;k=void 0===k?0:k;var n=[];if(a=document.querySelectorAll("table"+a))a=a[k];else return!1;if(!a||!a.children||!a.children[0].children)return!1;k=a.children[0].children;for(var t=0;t<k.length;t++){for(var z=[],C=k[t].querySelectorAll("thead th"),B=0;B<C.length;B++)b.includes(B)||z.push(C[B].innerText);n.push(z.join(","))}a=a.children[1].children;k=/\n\r?/g;t=/,/g;for(z=0;z<a.length;z++){C=[];B=a[z].querySelectorAll("tbody td");
for(var G=0;G<B.length;G++)b.includes(G)||C.push(B[G].innerText.replace(k," & ").replace(t," - "));n.push(C.join(","))}downloadCSV(n.join("\n"),d);return!0}
function ta_todo(){var a,b,d,k,n,t,z,C;return $jscomp.asyncExecutePromiseGeneratorProgram(function(B){switch(B.nextAddress){case 1:if(!is_todo_page()){B.jumpTo(0);break}b=".to-do-list";return B.yield(fetch_parse_canvas(api+"courses?enrollment_type=ta&enrollment_state=active"),4);case 4:d=B.yieldResult;a=d.map(function(G){return G.id});if(a.length)a.forEach(function(G,Q,R){return R[Q]='li.todo a[href*="/courses/'+G+'/"]'}),a=a.join(", ");else return B["return"]();k=0;n=$(b);case 5:if(n.length||!(10>
k)){B.jumpTo(6);break}return B.yield(sleep(250),7);case 7:k++;n=$(b);B.jumpTo(5);break;case 6:n.length||console.log("no todo selector");document.querySelectorAll(a).forEach(function(G){return G.parentNode.remove()});for(t=$("li.todo:visible").length;5>t&&t<=$("li.todo").length;)$("li.todo:hidden:first").css("display",""),t++;z=$("ul.to-do-list li a.more_link")[0];C=$("li.todo:hidden").length;z&&(0<C?z.innerText=C+" more...":z.remove());B.jumpToEnd()}})}
function add_people_functions(){var a,b,d,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:if(!is_course_user_page()){n.jumpTo(0);break}a=0;b="div#people-options .al-trigger";d=$(b);case 3:if(d.length||!(10>a)){n.jumpTo(4);break}return n.yield(sleep(250),5);case 5:a++;d=$(b);n.jumpTo(3);break;case 4:if(!d.length){console.log("no dotbutton selector");n.jumpTo(0);break}k=0;case 7:if(d[0].addEventListener||!(10>k)){n.jumpTo(8);break}return n.yield(sleep(250),
9);case 9:k++;d=$(b);n.jumpTo(7);break;case 8:d[0].addEventListener?(d[0].addEventListener("click",add_handler_for_student_list,!1),d[0].addEventListener("click",add_handler_for_export,!1)):(d[0].attachEvent("onclick",add_handler_for_student_list),d[0].attachEvent("onclick",add_handler_for_export)),n.jumpToEnd()}})}
function student_list(){var a,b,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return is_course_user_page()?k.yield(fetch_parse_canvas(api+window.location.pathname+"?sort=username&enrollment_type[]=student&per_page=100"),3):k.jumpTo(0);a=k.yieldResult;if(a.length)b="<table>",a.forEach(function(n,t,z){b+="<tr><td>"+n.name+"</td><td>"+n.email+"</td></tr>"}),d=window.open(""),d.document.write("<html><head><title>"+$("head > title").text()+"</title></head><body><em>"+
$("head > title").text()+"</em>"+b+"</table></body></html>");else return console.log("no users to present"),k["return"]();k.jumpToEnd()})}var show_student_list=function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){if(1==a.nextAddress)return a.yield(student_list(),2);a.jumpToEnd()})},added_student_list=!1;
function add_handler_for_student_list(){if(!added_student_list){var a=document.getElementsByClassName("al-options ui-menu ui-widget ui-widget-content")[0],b=document.createElement("li");b.setAttribute("role","presentation");b.setAttribute("class","ui-menu-item");var d=document.createElement("a"),k=document.createTextNode(" Display Student List");d.appendChild(k);d.title="Display Student List";d.href="#";d.setAttribute("class","ui-corner-all");d.setAttribute("tabindex","-1");d.setAttribute("role",
"menuitem");k=document.createElement("i");k.setAttribute("class","icon-printer");d.prepend(k);b.appendChild(d);a.appendChild(b);b.addEventListener?b.addEventListener("click",show_student_list,!1):b.attachEvent("onclick",show_student_list);added_student_list=!0}}var export_visible_list=function(){exportTableToCSV(".roster",[0,8],"roster_export.csv")},added_handler_for_export=!1;
function add_handler_for_export(){if(!added_handler_for_export){var a=document.getElementsByClassName("al-options ui-menu ui-widget ui-widget-content")[0],b=document.createElement("li");b.setAttribute("role","presentation");b.setAttribute("class","ui-menu-item");var d=document.createElement("a"),k=document.createTextNode(" Export Visible");d.appendChild(k);d.title="Export Visible";d.href="#";d.setAttribute("class","ui-corner-all");d.setAttribute("tabindex","-1");d.setAttribute("role","menuitem");
k=document.createElement("i");k.setAttribute("class","icon-archive");d.prepend(k);b.appendChild(d);a.appendChild(b);b.addEventListener?b.addEventListener("click",export_visible_list,!1):b.attachEvent("onclick",export_visible_list);added_handler_for_export=!0}}function hide_sidebars(){is_student_or_observer()&&!is_calendar_page()&&!is_user_profile_settings_page()&!is_dashboard()&&$("#right-side-wrapper").hide()}
function add_profile_grades(){var a=get_user_from_profile_uri();if(a){var b=window.location.origin+"/users/"+a+"/grades";a=$("<button/>",{text:"Grades",id:"btn_grades",click:function(){window.location.href=b;return!1}});a.addClass("btn button-sidebar-wide");$("#right-side").append(a)}}
function add_profile_file_quota_status(){var a,b,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return(a=get_user_from_profile_uri())?k.yield(fetch_parse_canvas(api+"users/"+a+"/files/quota?as_user_id="+a),3):k.jumpTo(0);b=k.yieldResult;d=(100*b.quota_used/b.quota).toFixed(2);d="<span>"+d+"% of file quota used</span>";$(d).insertAfter("#login_information");k.jumpToEnd()})}
(function(){function a(g){var e,f,c,l,m,h,u,p,q,r,x,w;return $jscomp.asyncExecutePromiseGeneratorProgram(function(v){if(1==v.nextAddress){e=n(g);f=k(g);c=0;if(!e||!e.length)return C(H.get("noRecipients"),"warning",6E3),v["return"](!1);if(!f)return v["return"](!1);L.ui.busy(L.ui.buttons.addObservers);m=l=new S;return v.yield(Q(e,f),2)}if(3!=v.nextAddress)return m.recipients=v.yieldResult,l.recipients=B(l.recipients),h=l,v.yield(R([k(g)]),3);h.contextEnrolments=v.yieldResult;G(l.recipients,l.contextEnrolments);
u=$jscomp.makeIterator(l.recipients);for(p=u.next();!p.done;p=u.next()){q=p.value;if(0<q.msgobs.observers.length)for(r={},x=$jscomp.makeIterator(q.msgobs.observers),w=x.next();!w.done;r={$jscomp$loop$prop$observer$50:r.$jscomp$loop$prop$observer$50},w=x.next())r.$jscomp$loop$prop$observer$50=w.value,l.recipients.find(function(A){return function(I){return I.id==A.$jscomp$loop$prop$observer$50.id}}(r))||(t(g,r.$jscomp$loop$prop$observer$50),c++);z(g,q)}c?C(c+" "+H.get("observersAdded"),"success",6E3):
C(H.get("noObservers"),"warning",6E3);L.ui.ready();v.jumpToEnd()})}function b(g){var e,f,c,l,m,h,u,p,q,r,x;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){if(1==w.nextAddress){e=n(g);f=k(g);c=0;if(!e.length)return C(H.get("noRecipients"),"warning",6E3),w["return"](!1);if(!f)return w["return"](!1);L.ui.busy(L.ui.buttons.removeStudents);m=l=new S;return w.yield(Q(e,f),2)}if(3!=w.nextAddress)return m.recipients=w.yieldResult,l.recipients=B(l.recipients),h=l,w.yield(R([k(g)]),3);h.contextEnrolments=
w.yieldResult;G(l.recipients,l.contextEnrolments);if("conversations"===g){switch(g){case "conversations":var v=[].concat($jscomp.arrayFromIterable(n(g)));if(v){v=$jscomp.makeIterator(v);for(var A=v.next();!A.done;A=v.next())conversationsRouter.compose.recipientView._removeToken(A.value)}}u=$jscomp.makeIterator(l.recipients);for(p=u.next();!p.done;p=u.next())q=p.value,t(g,q),z(g,q)}r=$jscomp.makeIterator(l.recipients);for(p=r.next();!p.done;p=r.next())if(x=p.value,"StudentEnrollment"===x.msgobs.role){switch(g){case "conversations":conversationsRouter.compose.recipientView._removeToken(x.id);
break;case "gradebook":for(v=document.querySelectorAll(F.get("gradesWindowClass")+" "+F.get("gradesRecipientElem")),v=$jscomp.makeIterator(v),A=v.next();!A.done;A=v.next())A=A.value,$(A).data("id")==x.id&&(A.style.display="hidden")}c++}c?C(c+" "+H.get("studentsRemoved"),"success",6E3):C(H.get("noStudents"),"warning",6E3);L.ui.ready();w.jumpToEnd()})}function d(g){switch(g){case "conversations":return F.get("convosWindowClass");case "gradebook":return F.get("gradesWindowClass")}}function k(g){switch(g){case "conversations":var e,
f,c,l,m;g=null!=(m=null==(e=conversationsRouter)?void 0:null==(f=e.compose)?void 0:null==(c=f.recipientView)?void 0:null==(l=c.currentContext)?void 0:l.id)?m:!1;e=L.ui.buttons.courseSelection.querySelector("input").value;if(/^course_[0-9]*$/.test(g))return L.ui.buttons.courseSelection.style.display="none",conversationsRouter.compose.recipientView.currentContext.id;if(/^[0-9]+$/.test(e))return e;L.ui.buttons.courseSelection.style.display="block";return!1;case "gradebook":return ENV.context_asset_string}}
function n(g){var e=[];switch(g){case "conversations":var f,c,l;(null==(f=conversationsRouter)?0:null==(c=f.compose)?0:null==(l=c.to)?0:l.includes("reply"))&&C(H.get("replyMessageToObservers"),"warning",2E4);return conversationsRouter.compose.recipientView.tokens;case "gradebook":return $("#message_assignment_recipients").find(".student:visible").each(function(){e.push($(this).data("id"))}),e}}function t(g,e){switch(g){case "conversations":typeof e.id!==String&&(e.id=String(e.id));window.conversationsRouter.compose.recipientView.setTokens([e]);
break;case "gradebook":var f=$("#message_students_dialog ul li.blank:first").clone(!1).removeClass("blank").addClass("msgobs-observer").data("id",e.id).css("display","list-item");$(".name",f).text(e.name);f.find("button").remove();var c=$('<div class="remove-button Button Button--icon-action"><i class="icon-x"></i></div>');c.on("click",function(){$(this).parent().remove()});f.append(c);$("#message_assignment_recipients .student_list").append(f)}}function z(g,e){switch(g){case "conversations":var f=
document.querySelectorAll(F.get("convosWindowClass")+" "+F.get("convosRecipientElem"));f=$jscomp.makeIterator(f);for(var c=f.next();!c.done;c=f.next()){c=c.value;var l=c.querySelector("input");if(l.defaultValue==e.id){if(e.msgobs.observers)for(var m=$jscomp.makeIterator(e.msgobs.observers),h=m.next();!h.done;h=m.next())h="Observed by: "+e.name,c.getAttribute("title")&&(h=c.getAttribute("title")+", + "+h+";"),c.setAttribute("title",h);if(e.msgobs.observing.length)for(c.style="background-color: "+O.get("observerColour")+
"; border-color: rgba(0,0,0,0.10);",h=$jscomp.makeIterator(e.msgobs.observing),m=h.next();!m.done;m=h.next())m="Observing: "+m.value.name,c.getAttribute("title")&&(m=c.getAttribute("title")+", "+m+";"),c.setAttribute("title",m)}if(e.msgobs.observers)for(m=$jscomp.makeIterator(e.msgobs.observers),h=m.next();!h.done;h=m.next())if(l.defaultValue==h.value.id){c.style="background-color: "+O.get("observerColour")+"; border-color: rgba(0,0,0,0.10);";h="Observing: "+e.name;var u=void 0;null!=(u=c.getAttribute("title"))&&
u.contains(h)||(c.getAttribute("title")&&(h=c.getAttribute("title")+", "+h+";"),c.setAttribute("title",h))}}break;case "gradebook":for(f=document.querySelectorAll(F.get("gradesWindowClass")+" "+F.get("gradesRecipientElem")),f=$jscomp.makeIterator(f),c=f.next();!c.done;c=f.next()){c=c.value;l=$(c).data("id");if(l==e.id&&e.msgobs.observers)for(m=$jscomp.makeIterator(e.msgobs.observers),h=m.next();!h.done;h=m.next())h="Observed by: "+e.name,c.getAttribute("title")&&(h=c.getAttribute("title")+", + "+
h+";"),c.setAttribute("title",h);if(e.msgobs.observers)for(m=$jscomp.makeIterator(e.msgobs.observers),h=m.next();!h.done;h=m.next())l==h.value.id&&(c.style.backgroundColor=O.get("observerColour"),c.style.borderColor="rgba(0,0,0,0.10)",h="Observing: "+e.name,c.getAttribute("title")&&(h=c.getAttribute("title")+", "+h+";"),c.setAttribute("title",h))}}}function C(g,e,f){try{var c=document.querySelector(F.get("flashMessageElem")),l=document.createElement("div");l.innerHTML='<li class="ic-flash-'+e+'" aria-hidden="true" style="z-index: 2;">\n                        <div class="ic-flash__icon">\n                            <i class="icon-check"></i>\n                        </div>\n                            '+
g+'\n                        <button type="button" class="Button Button--icon-action close_link" aria-label="Close">\n                            <i class="icon-x"></i>\n                        </button>\n                    </li>';c.appendChild(l);f&&setTimeout(function(){l.remove()},f)}catch(m){alert(g)}}function B(g){return g.filter(function(e,f,c){return c.findIndex(function(l){return l.id===e.id})===f})}function G(g,e){for(var f=$jscomp.makeIterator(g),c=f.next();!c.done;c=f.next()){c=c.value;
c.msgobs={observers:[],observing:[]};for(var l=$jscomp.makeIterator(e),m=l.next();!m.done;m=l.next()){m=m.value;c.id===m.user_id&&(c.msgobs.role=m.type,m.observed_user&&c.msgobs.observing.push(m.observed_user));var h=void 0;"ObserverEnrollment"==m.role&&c.id===(null==(h=m.observed_user)?void 0:h.id)&&c.msgobs.observers.push(m.user)}}}function Q(g,e){var f,c,l,m,h,u,p,q,r,x,w,v,A,I,J,y,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){switch(D.nextAddress){case 1:for(var P={courses:[],
courseSubgroups:[],sections:[],groups:[],users:[]},T=$jscomp.makeIterator(g),E=T.next();!E.done;E=T.next())E=E.value,E=new String(E),/^course_[0-9]*$/.test(E)&&P.courses.push(E),E.startsWith("section_")&&P.sections.push(E),E.startsWith("group_")&&P.groups.push(E),/^course_[0-9]*_[a-z]*/.test(E)&&P.courseSubgroups.push(E),/^[0-9]/.test(E)&&P.users.push(E);f=P;c=f.courses;l=f.courseSubgroups;m=f.sections;h=f.groups;u=f.users;p=[];if(0==c.length){D.jumpTo(2);break}q=p;r=q.push;return D.yield(X(c),3);
case 3:r.call(q,D.yieldResult);case 2:if(0==l.length){D.jumpTo(4);break}x=p;w=x.push;return D.yield(Y(l),5);case 5:w.call(x,D.yieldResult);case 4:if(0==m.length){D.jumpTo(6);break}v=p;A=v.push;return D.yield(Z(m),7);case 7:A.call(v,D.yieldResult);case 6:if(0==h.length){D.jumpTo(8);break}I=p;J=I.push;return D.yield(aa(h),9);case 9:J.call(I,D.yieldResult);case 8:if(0==u.length){D.jumpTo(10);break}y=p;K=y.push;return D.yield(ba(u,e),11);case 11:K.call(y,D.yieldResult);case 10:return p=p.flat(10),D["return"](p)}})}
function R(g){var e,f,c,l,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:e=[],f=$jscomp.makeIterator(g),c=f.next();case 2:if(c.done){h.jumpTo(4);break}l=c.value;l.startsWith("course_")&&(l=l.split("_")[1]);return h.yield(M({path:"/api/v1/courses/"+l+"/enrollments?include=observed_users&per_page=100"}),5);case 5:m=h.yieldResult;e.push.apply(e,$jscomp.arrayFromIterable(m));c=f.next();h.jumpTo(2);break;case 4:return e=e.flat(1),h["return"](e)}})}function Y(g){var e,
f,c,l,m,h,u,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){switch(q.nextAddress){case 1:e=[],f=$jscomp.makeIterator(g),c=f.next();case 2:if(c.done){q.jumpTo(4);break}l=c.value;m=$jscomp.makeIterator(l.split("_"));m.next();h=m.next().value;u=m.next().value;u=u.slice(0,-1);return q.yield(M({path:"/api/v1/courses/"+h+"/users?enrollment_type[]="+u+"&per_page=100"}),5);case 5:p=q.yieldResult;e.push.apply(e,$jscomp.arrayFromIterable(p));c=f.next();q.jumpTo(2);break;case 4:return q["return"](e)}})}
function Z(g){var e,f,c,l,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:e=[],f=$jscomp.makeIterator(g),c=f.next();case 2:if(c.done){h.jumpTo(4);break}l=c.value;l.startsWith("section_")&&(l=l.split("_")[1]);return h.yield(M({path:"/api/v1/sections/"+l+"?include=students&per_page=100"}),5);case 5:m=h.yieldResult;e.push.apply(e,$jscomp.arrayFromIterable(m[0].students));c=f.next();h.jumpTo(2);break;case 4:return h["return"](e)}})}function aa(g){var e,f,
c,l,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:e=[],f=$jscomp.makeIterator(g),c=f.next();case 2:if(c.done){h.jumpTo(4);break}l=c.value;l.startsWith("group_")&&(l=l.split("_")[1]);return h.yield(M({path:"/api/v1/groups/"+l+"/users?per_page=100"}),5);case 5:m=h.yieldResult;e.push(m);c=f.next();h.jumpTo(2);break;case 4:return h["return"](e)}})}function X(g){var e,f,c,l,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:e=
[],f=$jscomp.makeIterator(g),c=f.next();case 2:if(c.done){h.jumpTo(4);break}l=c.value;l.startsWith("course_")&&(l=l.split("_")[1]);return h.yield(M({path:"/api/v1/courses/"+l+"/users?per_page=100"}),5);case 5:m=h.yieldResult;e.push.apply(e,$jscomp.arrayFromIterable(m));c=f.next();h.jumpTo(2);break;case 4:return h["return"](e)}})}function ba(g,e){var f,c,l,m,h,u,p,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return f=[],e.startsWith("course_")&&(e=e.split("_")[1]),
r.yield(M({path:"/api/v1/courses/"+e+"/users?per_page=100"}),2);c=r.yieldResult;c=c.flat(3);l=$jscomp.makeIterator(g);for(m=l.next();!m.done;m=l.next())for(h=m.value,u=$jscomp.makeIterator(c),p=u.next();!p.done;p=u.next())q=p.value,h==q.id&&f.push(q);return r["return"](f)})}function ca(){var g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress)return e.yield(M({path:"/api/v1/users/self/enrollments?per_page=100"}),2);g=e.yieldResult;g=g.flat(3);return e["return"](g)})}
function da(g){var e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return f.yield(M({path:"/api/v1/courses/"+g}),2);e=f.yieldResult;e=e.flat(3);return f["return"](e)})}function U(){return O.get("useToken")?new Headers({"Content-Type":"application/json",Authorization:"Bearer "+O.get("token")}):new Headers({"Content-Type":"application/json"})}function M(g){var e,f,c,l,m,h,u,p,q,r,x,w,v,A,I,J;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){switch(y.nextAddress){case 1:return y.setCatchFinallyBlocks(2),
e=g,f=e.path,c=[],y.yield(fetch(""+f,{headers:U()}),4);case 4:return l=y.yieldResult,m=JSON,h=m.parse,u=V,y.yield(l.text(),5);case 5:p=h.call(m,u(y.yieldResult));c.push(p);if(!l.headers.get("link")){y.jumpTo(6);break}q=W(l.headers.get("link"));if(!q.get("next")){y.jumpTo(6);break}case 8:return y.yield(fetch(q.get("next"),{headers:U()}),11);case 11:return r=y.yieldResult,q=W(r.headers.get("link")),x=c,w=x.push,v=JSON,A=v.parse,I=V,y.yield(r.text(),12);case 12:if(w.call(x,A.call(v,I(y.yieldResult))),
q.get("current")!==q.get("last")){y.jumpTo(8);break}case 6:return y["return"](c);case 2:J=y.enterCatchBlock(),C("An Error Occured. Please refresh the page and try again. \n "+J,"error",6E4),y.jumpToEnd()}})}function V(g){return g.replace(/^while\(1\);/g,"")}function W(g){var e=new Map;g=$jscomp.makeIterator(g.matchAll(/(?:<(.*?)>).*?(?:rel="(.*?)")/g));for(var f=g.next();!f.done;f=g.next())f=f.value,e.set(f[2],f[1]);return e}var O=new Map([["autoCheckBulkMsgBox",!0],["observerColour","bisque"],["buttonWidth",
"110px"],["autoTickIndividualMsgCheckbox",!0],["instanceUrl",""],["browser",!0],["useToken",!1],["token",""]]),H=new Map([["btnAddObservers","Include Observers"],["btnRemoveStudents","Remove Students"],["busy","Working..."],["noStudents","There are no students in the recipient list."],["observersAdded","observers added."],["noObservers","No observers found."],["studentsRemoved","students removed."],["noRecipients","There are no recipients in the recipient list."],["groupExpansion","Your recipient list contains groups. Groups will be expanded into their respective members."],
["noContext","No course context was detected. Please select a course to be used for observer lookups or enter the Course ID manually, then try again."],["replyMessageToObservers","You're adding observers to a reply message. Reply messages create group conversations with all recipients included. Recipients will see each other's replies."]]),F=new Map([["convosWindowClass","div.compose-message-dialog"],["convosBtnContainer",".attachments"],["convosRecipientElem",".ac-token"],["convosComposeBtn","#compose-btn"],
["convosBulkMsg","#bulk_message"],["gradesWindowClass","#message_students_dialog"],["gradesBtnContainer",".button-container"],["gradesRecipientElem",".student:not(.blank)"],["gradesMessageTypesElem","#message_assignment_recipients .message_types"],["flashMessageElem","#flash_message_holder"]]),L={},S=function(){this.recipients=[];this.contextEnrolments=[];this.newRecipients=[]},N=function(g){var e=this;this.buttons={addObservers:this.newButton(H.get("btnAddObservers"),g),removeStudents:this.newButton(H.get("btnRemoveStudents"),
g)};this.buttons.addObservers.addEventListener("click",function(f){e.insertObservers(g)});this.buttons.removeStudents.addEventListener("click",function(f){e.removeStudents(g)});this.insert(g,this.buttons)};N.prototype.newButton=function(g,e){var f=document.createElement("div");f.appendChild(document.createTextNode(g));f.classList.add("ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only");f.style.margin="0 2px";"gradebook"===e&&(f.style["float"]="left");return f};N.prototype.insert=
function(g,e){var f=this,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress){if("conversations"!==g)return l.jumpTo(2);c=f.buttons;return l.yield(f.courseSelectionInputUi(),3)}2!=l.nextAddress&&(c.courseSelection=l.yieldResult);setTimeout(function(){if(document.querySelector(d(g))){f.dialog=document.querySelector(d(g));for(var m=$jscomp.makeIterator(Object.values(e)),h=m.next();!h.done;h=m.next()){h=h.value;var u=document,p=u.querySelector;a:{switch(g){case "conversations":var q=
F.get("convosBtnContainer");break a;case "gradebook":q=F.get("gradesBtnContainer");break a}q=void 0}p.call(u,q).appendChild(h)}"conversations"===g&&O.get("autoCheckBulkMsgBox")&&document.querySelector(F.get("convosBulkMsg"))&&(document.querySelector(F.get("convosBulkMsg")).checked=!0);"gradebook"===g&&document.querySelector(F.get("gradesMessageTypesElem")).addEventListener("change",function(){var r=document.querySelectorAll("msgobs-observer");r=$jscomp.makeIterator(r);for(var x=r.next();!x.done;x=
r.next())x.value.remove()})}else f.insert(g,e)},1E3);l.jumpToEnd()})};N.prototype.insertObservers=function(g){a(g)};N.prototype.removeStudents=function(g){b(g)};N.prototype.busy=function(g){this.buttons.addObservers.setAttribute("disabled","");this.buttons.removeStudents.setAttribute("disabled","");g.innerText=H.get("busy")};N.prototype.ready=function(){this.buttons.addObservers.removeAttribute("disabled");this.buttons.addObservers.innerText=H.get("btnAddObservers");this.buttons.removeStudents.removeAttribute("disabled");
this.buttons.removeStudents.innerText=H.get("btnRemoveStudents")};N.prototype.courseSelectionInputUi=function(){var g,e,f,c,l,m,h,u,p,q,r,x,w,v,A,I,J,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){switch(K.nextAddress){case 1:return K.yield(ca(),2);case 2:g=K.yieldResult,e=[],f=$jscomp.makeIterator(g),c=f.next();case 3:if(c.done){K.jumpTo(5);break}l=c.value;if("TeacherEnrollment"!==l.role){K.jumpTo(4);break}m=e.push;h=m.apply;u=e;p=$jscomp;q=p.arrayFromIterable;return K.yield(da(l.course_id),
7);case 7:h.call(m,u,q.call(p,K.yieldResult));case 4:c=f.next();K.jumpTo(3);break;case 5:r=document.createElement("div");x=document.createElement("select");w=document.createElement("input");r.style="margin: .5em 0; display: none;";r.innerHTML=H.get("noContext")+"<br />";w.setAttribute("type","text");w.setAttribute("placeholder","Course ID");w.style="width: 5em";v=document.createElement("option");v.appendChild(document.createTextNode("Select a course..."));x.appendChild(v);A=$jscomp.makeIterator(e);
for(I=A.next();!I.done;I=A.next())J=I.value,"available"===J.workflow_state&&(y=document.createElement("option"),y.value=J.id,J.sis_course_id&&y.appendChild(document.createTextNode(J.sis_course_id+" ")),J.name&&y.appendChild(document.createTextNode(J.name)),x.appendChild(y));r.appendChild(x);r.appendChild(w);x.addEventListener("change",function(){/^[0-9]*$/.test(x.value)?w.value=x.value:w.value=""});document.querySelector(F.get("convosComposeBtn")).addEventListener("click",function(){r.style.display=
"none";w.value=""});return K["return"](r)}})};(function(){if(O.get("browser")){var g=new String(window.location.href),e=!1,f,c,l=(null==(f=window.ENV)?void 0:f.current_user_roles.includes("teacher"))||(null==(c=window.ENV)?void 0:c.current_user_roles.includes("admin"));g.includes("/conversations")&&(e="conversations");g.includes("/gradebook")&&(e="gradebook");e&&l&&(console.log("--- \n MSGOBS v1.02  \n https://github.com/sdjrice/msgobs \n sdjrice@gmail.com \n ---"),L.ui=new N(e))}})()})();